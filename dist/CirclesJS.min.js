!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Circles=t():e.Circles=t()}(this,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s="./src/CirclesJS.js")}({"./src/CirclesJS.js":
/*!**************************!*\
  !*** ./src/CirclesJS.js ***!
  \**************************/
/*! no static exports found */function(e,t){window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame}})});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9DaXJjbGVzL3dlYnBhY2svdW5pdmVyc2FsTW9kdWxlRGVmaW5pdGlvbiIsIndlYnBhY2s6Ly9DaXJjbGVzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL0NpcmNsZXMvLi9zcmMvQ2lyY2xlc0pTLmpzIl0sIm5hbWVzIjpbInJvb3QiLCJmYWN0b3J5IiwiZXhwb3J0cyIsIm1vZHVsZSIsImRlZmluZSIsImFtZCIsInRoaXMiLCJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwid2luZG93IiwicmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwid2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIiwibXNSZXF1ZXN0QW5pbWF0aW9uRnJhbWUiXSwibWFwcGluZ3MiOiJDQUFBLFNBQUFBLEVBQUFDLEdBQ0EsaUJBQUFDLFNBQUEsaUJBQUFDLE9BQ0FBLE9BQUFELFFBQUFELElBQ0EsbUJBQUFHLGVBQUFDLElBQ0FELE9BQUEsR0FBQUgsR0FDQSxpQkFBQUMsUUFDQUEsUUFBQSxRQUFBRCxJQUVBRCxFQUFBLFFBQUFDLElBUkEsQ0FTQ0ssS0FBQSxXQUNELG1CQ1RBLElBQUFDLEVBQUEsR0FHQSxTQUFBQyxFQUFBQyxHQUdBLEdBQUFGLEVBQUFFLEdBQ0EsT0FBQUYsRUFBQUUsR0FBQVAsUUFHQSxJQUFBQyxFQUFBSSxFQUFBRSxHQUFBLENBQ0FDLEVBQUFELEVBQ0FFLEdBQUEsRUFDQVQsUUFBQSxJQVVBLE9BTkFVLEVBQUFILEdBQUFJLEtBQUFWLEVBQUFELFFBQUFDLElBQUFELFFBQUFNLEdBR0FMLEVBQUFRLEdBQUEsRUFHQVIsRUFBQUQsUUEwREEsT0FyREFNLEVBQUFNLEVBQUFGLEVBR0FKLEVBQUFPLEVBQUFSLEVBR0FDLEVBQUFRLEVBQUEsU0FBQWQsRUFBQWUsRUFBQUMsR0FDQVYsRUFBQVcsRUFBQWpCLEVBQUFlLElBQ0FHLE9BQUFDLGVBQUFuQixFQUFBZSxFQUFBLENBQTBDSyxZQUFBLEVBQUFDLElBQUFMLEtBSzFDVixFQUFBZ0IsRUFBQSxTQUFBdEIsR0FDQSxvQkFBQXVCLGVBQUFDLGFBQ0FOLE9BQUFDLGVBQUFuQixFQUFBdUIsT0FBQUMsWUFBQSxDQUF3REMsTUFBQSxXQUV4RFAsT0FBQUMsZUFBQW5CLEVBQUEsY0FBaUR5QixPQUFBLEtBUWpEbkIsRUFBQW9CLEVBQUEsU0FBQUQsRUFBQUUsR0FFQSxHQURBLEVBQUFBLElBQUFGLEVBQUFuQixFQUFBbUIsSUFDQSxFQUFBRSxFQUFBLE9BQUFGLEVBQ0EsS0FBQUUsR0FBQSxpQkFBQUYsUUFBQUcsV0FBQSxPQUFBSCxFQUNBLElBQUFJLEVBQUFYLE9BQUFZLE9BQUEsTUFHQSxHQUZBeEIsRUFBQWdCLEVBQUFPLEdBQ0FYLE9BQUFDLGVBQUFVLEVBQUEsV0FBeUNULFlBQUEsRUFBQUssVUFDekMsRUFBQUUsR0FBQSxpQkFBQUYsRUFBQSxRQUFBTSxLQUFBTixFQUFBbkIsRUFBQVEsRUFBQWUsRUFBQUUsRUFBQSxTQUFBQSxHQUFnSCxPQUFBTixFQUFBTSxJQUFxQkMsS0FBQSxLQUFBRCxJQUNySSxPQUFBRixHQUlBdkIsRUFBQTJCLEVBQUEsU0FBQWhDLEdBQ0EsSUFBQWUsRUFBQWYsS0FBQTJCLFdBQ0EsV0FBMkIsT0FBQTNCLEVBQUEsU0FDM0IsV0FBaUMsT0FBQUEsR0FFakMsT0FEQUssRUFBQVEsRUFBQUUsRUFBQSxJQUFBQSxHQUNBQSxHQUlBVixFQUFBVyxFQUFBLFNBQUFpQixFQUFBQyxHQUFzRCxPQUFBakIsT0FBQWtCLFVBQUFDLGVBQUExQixLQUFBdUIsRUFBQUMsSUFHdEQ3QixFQUFBZ0MsRUFBQSxHQUlBaEMsSUFBQWlDLEVBQUE7Ozs7NENDOUVBQyxPQUFPQyxzQkFBd0JELE9BQU9DLHVCQUF5QkQsT0FBT0UsMEJBQ3RFRixPQUFPRyw2QkFBK0JILE9BQU9JIiwiZmlsZSI6IkNpcmNsZXNKUy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gd2VicGFja1VuaXZlcnNhbE1vZHVsZURlZmluaXRpb24ocm9vdCwgZmFjdG9yeSkge1xuXHRpZih0eXBlb2YgZXhwb3J0cyA9PT0gJ29iamVjdCcgJiYgdHlwZW9mIG1vZHVsZSA9PT0gJ29iamVjdCcpXG5cdFx0bW9kdWxlLmV4cG9ydHMgPSBmYWN0b3J5KCk7XG5cdGVsc2UgaWYodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKVxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdGVsc2UgaWYodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKVxuXHRcdGV4cG9ydHNbXCJDaXJjbGVzXCJdID0gZmFjdG9yeSgpO1xuXHRlbHNlXG5cdFx0cm9vdFtcIkNpcmNsZXNcIl0gPSBmYWN0b3J5KCk7XG59KSh0aGlzLCBmdW5jdGlvbigpIHtcbnJldHVybiAiLCIgXHQvLyBUaGUgbW9kdWxlIGNhY2hlXG4gXHR2YXIgaW5zdGFsbGVkTW9kdWxlcyA9IHt9O1xuXG4gXHQvLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuIFx0ZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXG4gXHRcdC8vIENoZWNrIGlmIG1vZHVsZSBpcyBpbiBjYWNoZVxuIFx0XHRpZihpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSkge1xuIFx0XHRcdHJldHVybiBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXS5leHBvcnRzO1xuIFx0XHR9XG4gXHRcdC8vIENyZWF0ZSBhIG5ldyBtb2R1bGUgKGFuZCBwdXQgaXQgaW50byB0aGUgY2FjaGUpXG4gXHRcdHZhciBtb2R1bGUgPSBpbnN0YWxsZWRNb2R1bGVzW21vZHVsZUlkXSA9IHtcbiBcdFx0XHRpOiBtb2R1bGVJZCxcbiBcdFx0XHRsOiBmYWxzZSxcbiBcdFx0XHRleHBvcnRzOiB7fVxuIFx0XHR9O1xuXG4gXHRcdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuIFx0XHRtb2R1bGVzW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuIFx0XHQvLyBGbGFnIHRoZSBtb2R1bGUgYXMgbG9hZGVkXG4gXHRcdG1vZHVsZS5sID0gdHJ1ZTtcblxuIFx0XHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuIFx0XHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG4gXHR9XG5cblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGVzIG9iamVjdCAoX193ZWJwYWNrX21vZHVsZXNfXylcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubSA9IG1vZHVsZXM7XG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlIGNhY2hlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmMgPSBpbnN0YWxsZWRNb2R1bGVzO1xuXG4gXHQvLyBkZWZpbmUgZ2V0dGVyIGZ1bmN0aW9uIGZvciBoYXJtb255IGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uZCA9IGZ1bmN0aW9uKGV4cG9ydHMsIG5hbWUsIGdldHRlcikge1xuIFx0XHRpZighX193ZWJwYWNrX3JlcXVpcmVfXy5vKGV4cG9ydHMsIG5hbWUpKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIG5hbWUsIHsgZW51bWVyYWJsZTogdHJ1ZSwgZ2V0OiBnZXR0ZXIgfSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGRlZmluZSBfX2VzTW9kdWxlIG9uIGV4cG9ydHNcbiBcdF9fd2VicGFja19yZXF1aXJlX18uciA9IGZ1bmN0aW9uKGV4cG9ydHMpIHtcbiBcdFx0aWYodHlwZW9mIFN5bWJvbCAhPT0gJ3VuZGVmaW5lZCcgJiYgU3ltYm9sLnRvU3RyaW5nVGFnKSB7XG4gXHRcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFN5bWJvbC50b1N0cmluZ1RhZywgeyB2YWx1ZTogJ01vZHVsZScgfSk7XG4gXHRcdH1cbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsICdfX2VzTW9kdWxlJywgeyB2YWx1ZTogdHJ1ZSB9KTtcbiBcdH07XG5cbiBcdC8vIGNyZWF0ZSBhIGZha2UgbmFtZXNwYWNlIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDE6IHZhbHVlIGlzIGEgbW9kdWxlIGlkLCByZXF1aXJlIGl0XG4gXHQvLyBtb2RlICYgMjogbWVyZ2UgYWxsIHByb3BlcnRpZXMgb2YgdmFsdWUgaW50byB0aGUgbnNcbiBcdC8vIG1vZGUgJiA0OiByZXR1cm4gdmFsdWUgd2hlbiBhbHJlYWR5IG5zIG9iamVjdFxuIFx0Ly8gbW9kZSAmIDh8MTogYmVoYXZlIGxpa2UgcmVxdWlyZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy50ID0gZnVuY3Rpb24odmFsdWUsIG1vZGUpIHtcbiBcdFx0aWYobW9kZSAmIDEpIHZhbHVlID0gX193ZWJwYWNrX3JlcXVpcmVfXyh2YWx1ZSk7XG4gXHRcdGlmKG1vZGUgJiA4KSByZXR1cm4gdmFsdWU7XG4gXHRcdGlmKChtb2RlICYgNCkgJiYgdHlwZW9mIHZhbHVlID09PSAnb2JqZWN0JyAmJiB2YWx1ZSAmJiB2YWx1ZS5fX2VzTW9kdWxlKSByZXR1cm4gdmFsdWU7XG4gXHRcdHZhciBucyA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gXHRcdF9fd2VicGFja19yZXF1aXJlX18ucihucyk7XG4gXHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShucywgJ2RlZmF1bHQnLCB7IGVudW1lcmFibGU6IHRydWUsIHZhbHVlOiB2YWx1ZSB9KTtcbiBcdFx0aWYobW9kZSAmIDIgJiYgdHlwZW9mIHZhbHVlICE9ICdzdHJpbmcnKSBmb3IodmFyIGtleSBpbiB2YWx1ZSkgX193ZWJwYWNrX3JlcXVpcmVfXy5kKG5zLCBrZXksIGZ1bmN0aW9uKGtleSkgeyByZXR1cm4gdmFsdWVba2V5XTsgfS5iaW5kKG51bGwsIGtleSkpO1xuIFx0XHRyZXR1cm4gbnM7XG4gXHR9O1xuXG4gXHQvLyBnZXREZWZhdWx0RXhwb3J0IGZ1bmN0aW9uIGZvciBjb21wYXRpYmlsaXR5IHdpdGggbm9uLWhhcm1vbnkgbW9kdWxlc1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5uID0gZnVuY3Rpb24obW9kdWxlKSB7XG4gXHRcdHZhciBnZXR0ZXIgPSBtb2R1bGUgJiYgbW9kdWxlLl9fZXNNb2R1bGUgP1xuIFx0XHRcdGZ1bmN0aW9uIGdldERlZmF1bHQoKSB7IHJldHVybiBtb2R1bGVbJ2RlZmF1bHQnXTsgfSA6XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0TW9kdWxlRXhwb3J0cygpIHsgcmV0dXJuIG1vZHVsZTsgfTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kKGdldHRlciwgJ2EnLCBnZXR0ZXIpO1xuIFx0XHRyZXR1cm4gZ2V0dGVyO1xuIFx0fTtcblxuIFx0Ly8gT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm8gPSBmdW5jdGlvbihvYmplY3QsIHByb3BlcnR5KSB7IHJldHVybiBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwob2JqZWN0LCBwcm9wZXJ0eSk7IH07XG5cbiBcdC8vIF9fd2VicGFja19wdWJsaWNfcGF0aF9fXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnAgPSBcIlwiO1xuXG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gXCIuL3NyYy9DaXJjbGVzSlMuanNcIik7XG4iLCJjb25zdCBQRVJDID0gXCJwZXJjZW50YWdlXCIsTlVNQj0gXCJudW1iZXJcIiwgVElNRSA9XCJ0aW1lXCIsIHJpZ2h0VG9wID0gXCJyaWdodFRvcFwiLCBsZWZ0VG9wID0gXCJsZWZ0VG9wXCI7XG4vKlxuKiByZXF1ZXN0QW5pbWF0aW9uRnJhbWUgcG9seWZpbGxlXG4qICovXG53aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSB8fCB3aW5kb3cubW96UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG53aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8IHdpbmRvdy5tc1JlcXVlc3RBbmltYXRpb25GcmFtZTtcblxuLyoqXG4gKiBmdW5jdGlvbiByZXR1cm4gdG8gY29udmVydCBkZWdyZWUgYW5nbGUgdG8gYSByYWRpYW4gYW5nbGVcbiAqIEBwYXJhbSB7bnVtYmVyfSBkZWcgdGhlIGRlZ3JlZSB0byBjb252ZXJ0XG4gKiAqL1xuZnVuY3Rpb24gZGVnVG9SYWQoZGVnKXtcbiAgICByZXR1cm4gZGVnKk1hdGguUEkvMTgwIDtcbn1cblxuLyoqXG4gKiBmdW5jdGlvbiB0byBjb252ZXJ0IHRpbWVzIGluIGZvcm0gSEg6TU06U1MgdG8gU2Vjb25kc1xuICogQHBhcmFtIHtTdHJpbmd9IHN0cmluZ1xuICogQHJldHVybiB7bnVtYmVyfVxuICovXG5mdW5jdGlvbiBTVGltZVRvVGltZVN0YW1wKHN0cmluZyl7XG4gICAgdmFyIHRpbWVTdGFtcD0wIDtcbiAgICBpZigvXlxcZHsxLDN9OlxcZHsxLDJ9OlxcZHsxLDJ9JC8udGVzdChzdHJpbmcpKSB7XG4gICAgICAgIHZhciB0aW1lcyA9IHN0cmluZy5zcGxpdChcIjpcIikucmV2ZXJzZSgpO1xuICAgICAgICBmb3IodmFyIGluZGV4ID0gMCA7IGluZGV4IDwgdGltZXMubGVuZ3RoIDsgaW5kZXgrKyl7XG4gICAgICAgICAgICB0aW1lU3RhbXAgKz0gcGFyc2VJbnQodGltZXNbaW5kZXhdKSpNYXRoLnBvdyg2MCxpbmRleCk7XG4gICAgICAgIH1cblxuICAgIH1cbiAgICByZXR1cm4gdGltZVN0YW1wIDtcbn1cbi8qKlxuICogZnVuY3Rpb24gdG8gYWRkIHplcm8ncyB0byB0aGUgYmVnaW5uaW5nIG9mIG51bWJlclxuICogQHBhcmFtIHtzdHJpbmd9IG51bWIgd2hpY2ggeW91IHdhbm5hIGFkZCB6ZXJvJ3NcbiAqIEBwYXJhbSB7bnVtYmVyfSBNYXhMZW5ndGggbGVuZ3RoIG9mIG51bWJlciBhcyBzdHJpbmcgc3RhcnQgZnJvbSAwXG4gKiAqL1xuZnVuY3Rpb24gd2l0aFplcm8obnVtYixNYXhMZW5ndGgpe1xuICAgIHZhciByZXMgPSBTdHJpbmcobnVtYik7XG4gICAgaWYoIWlzTmFOKHBhcnNlSW50KG51bWIpKSAmJiBNYXhMZW5ndGggPj0gMCl7XG4gICAgICAgIGZvcih2YXIgaSA9IFN0cmluZyhudW1iKS5sZW5ndGggOyBpPCBNYXhMZW5ndGggOyBpKyspe1xuICAgICAgICAgICAgcmVzID0gXCIwXCIrcmVzO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXM7XG59XG4vKipcbiAqIGZ1bmN0aW9uIHRvIGNvbnZlcnQgYSB0aW1lIFN0YW1wIGluIFNlY29uZHMgdG8gZm9ybSBISDpNTTpTU1xuICogQHJldHVybiB7c3RyaW5nfVxuICogKi9cbmZ1bmN0aW9uIFRpbWVTdGFtcFRvU3RyaW5nKHRpbWVTdGFtcCl7XG4gICAgdmFyIFN0cmluZyA9IFwiXCI7XG4gICAgaWYoIWlzTmFOKHBhcnNlSW50KHRpbWVTdGFtcCkpICYmIHRpbWVTdGFtcCA+IDApe1xuICAgICAgICBmb3IodmFyIGkgPSAyIDsgaT49MSA7IGktLSl7XG4gICAgICAgICAgICBpZih0aW1lU3RhbXAgPiBNYXRoLmZsb29yKHRpbWVTdGFtcC8oTWF0aC5wb3coNjAsaSkpKSl7XG4gICAgICAgICAgICAgICAgdmFyIGsgPSBNYXRoLmZsb29yKHRpbWVTdGFtcC8oTWF0aC5wb3coNjAsaSkpKTtcbiAgICAgICAgICAgICAgICBTdHJpbmcgKz0gd2l0aFplcm8od2luZG93LlN0cmluZyhrKSwyKStcIjpcIjtcbiAgICAgICAgICAgICAgICB0aW1lU3RhbXAgLT0gTWF0aC5mbG9vcihrKihNYXRoLnBvdyg2MCxpKSkpO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgU3RyaW5nICs9IFwiMDpcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZih0aW1lU3RhbXA+PTApe1xuICAgICAgICAgICAgU3RyaW5nICs9IHdpdGhaZXJvKHdpbmRvdy5TdHJpbmcoTWF0aC5mbG9vcih0aW1lU3RhbXApKSwyKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gU3RyaW5nIDtcbn1cblxuLyoqXG4gKiBmdW5jdGlvbiB0byBnZXQgYSBjYXJ0ZXNpYW4gY29vcmRpbmF0aW9uIGZyb20gcG9sYXIgY29vcmRpbmF0aW9uXG4gKiBAcGFyYW0ge29iamVjdH0gbWlkZGxlQ29yZCBjb3JkIG9mIGNlbnRlciBvZiB0aGUgY2lyY2xlXG4gKiBAcGFyYW0ge051bWJlcn0gY2lyY2xlUiB0aGUgcmF5b24gb2YgdGhlIGNpcmNsZVxuICogQHBhcmFtIHtOdW1iZXJ9IGFuZ2xlIGFuZ2xlIG9mIHRoZSBwb2xhciBjb29yZGluYXRpb25cbiAqXG4gKiAqL1xuZnVuY3Rpb24gZ2V0Q29yZEZyb21BbmdsZShtaWRkbGVDb3JkICwgY2lyY2xlUiwgYW5nbGUpe1xuICAgIHZhciBwb2ludENvcmQgPSB7fTtcbiAgICBwb2ludENvcmRbXCJ4XCJdID1NYXRoLmZsb29yKCBtaWRkbGVDb3JkLnggKyBjaXJjbGVSKk1hdGguY29zKGFuZ2xlKSApO1xuICAgIHBvaW50Q29yZFtcInlcIl0gPU1hdGguZmxvb3IoIG1pZGRsZUNvcmQueSArIGNpcmNsZVIqTWF0aC5zaW4oYW5nbGUpICk7XG4gICAgcmV0dXJuIHBvaW50Q29yZCA7XG59XG5cbi8qKlxuICogdGhlIG1haW4gbGlicmFyeVxuICogQHBhcmFtIHtvYmplY3R9IGNhbnZhc0VsZW1lbnQgY2FudmFzIGRvbSBlbGVtZW50XG4gKiBAcGFyYW0ge29iamVjdH0gY2lyY2xlU3R5bGUgb2JqZWN0IGNvbnRhaW4gdGhlIGNpcmNsZSBzdHlsZXNcbiAqIEBwYXJhbSB7TnVtYmVyfSBwZXJjZW50YWdlIG51bWJlciB0byBkZXNpZ24gcGVyY2VudGFnZSBvZiBmaWxsZWQgY2lyY2xlXG4gKiAqL1xuZnVuY3Rpb24gQ2lyY2xlKGNhbnZhc0VsZW1lbnQsIGNpcmNsZVN0eWxlICwgcGVyY2VudGFnZSl7XG4gICAgdGhpcy5kaW1zID0ge1xuICAgICAgICB3IDogY2FudmFzRWxlbWVudC5vZmZzZXRXaWR0aCAsXG4gICAgICAgIGggOiBjYW52YXNFbGVtZW50Lm9mZnNldEhlaWdodFxuICAgIH07XG4gICAgdGhpcy5zdHlsZSA9IGNpcmNsZVN0eWxlIDtcbiAgICB0aGlzLmVsID0gY2FudmFzRWxlbWVudCA7XG4gICAgdGhpcy5jb250ZW50ID0gY2FudmFzRWxlbWVudC5nZXRDb250ZXh0KFwiMmRcIik7XG4gICAgdGhpcy5wZXJjID0gcGVyY2VudGFnZSA7XG4gICAgdGhpcy5vbGRQZXJjID0gMDtcbiAgICB0aGlzLmN1cnJlbnRUaW1lID0gMCA7XG4gICAgdGhpcy5kcmF3aW5nID0gZmFsc2UgO1xuXG4gICAgdGhpcy5nZXRSYXlvbiA9IGZ1bmN0aW9uICgpe1xuICAgICAgICB2YXIgcmFkaXVzID0gdGhpcy5kaW1zLncvMjtcbiAgICAgICAgaWYodHlwZW9mIHRoaXMuc3R5bGUucmFkaXVzID09IFwibnVtYmVyXCIgJiYgdGhpcy5zdHlsZS5yYWRpdXMgPjEpe1xuICAgICAgICAgICAgcmFkaXVzID0gdGhpcy5zdHlsZS5yYWRpdXMgO1xuICAgICAgICB9XG4gICAgICAgIGlmKHRoaXMuc3R5bGUuaGFzT3duUHJvcGVydHkoXCJsaW5lRm9yY2VcIikgJiYgdGhpcy5zdHlsZS5saW5lRm9yY2UgPiAxICl7XG4gICAgICAgICAgICByZXR1cm4gcmFkaXVzLSB0aGlzLnN0eWxlLmxpbmVGb3JjZS8yIDtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmFkaXVzIDtcbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gcmV0dXJuIGFuIGFuZ2xlIGluIHJhZGlhblxuICAgICAqIEBwYXJhbSB7TnVtYmVyfSB2YWx1ZSAgcGVyY2VudGFnZSB0byBjb252ZXJ0IGluIGFuZ2xlXG4gICAgICogKi9cbiAgICB0aGlzLnBvcmNUb1JhZCA9IGZ1bmN0aW9uICh2YWx1ZSl7XG4gICAgICAgIGlmKHRoaXMuc3R5bGUuaGFzT3duUHJvcGVydHkoXCJtYXhWYWx1ZVwiKSl7XG4gICAgICAgICAgICBpZih0aGlzLnN0eWxlLmhhc093blByb3BlcnR5KFwibWF4QW5nbGVcIikpe1xuICAgICAgICAgICAgICAgIHJldHVybiBkZWdUb1JhZCh0aGlzLnN0eWxlLm1heEFuZ2xlKSAqIHZhbHVlL3RoaXMuc3R5bGUubWF4VmFsdWUgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIDIqTWF0aC5QSSp2YWx1ZS90aGlzLnN0eWxlLm1heFZhbHVlIDtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmdW5jdGlvbiBnZXQgY29vcmRpbmF0aW9uIG9mIGEgdGV4dCBpZiBpdCBpbiB0aGUgbWlkZGxlXG4gICAgICogQHBhcmFtIHtTdHJpbmd9IHRleHQgdGhlIHZhbHVlIHRvIHdyaXRlIGl0IGluIHRoZSBtaWRkbGUgb2YgY2FudmFzXG4gICAgICogQHJldHVybiB7T2JqZWN0fSBjb250YWluIGNvb3JkaW5hdGlvbiBvXG4gICAgICogKi9cbiAgICB0aGlzLmdldFRleHRNaWRkbGUgPSBmdW5jdGlvbiAodGV4dCl7XG4gICAgICAgIHZhciB0ZXh0V2R0aCA9IHRoaXMuY29udGVudC5tZWFzdXJlVGV4dCh0ZXh0KS53aWR0aDtcbiAgICAgICAgdmFyIFNpemUgPSAxMDsgLy8gREVGQVVMVCBGT05UIFNJWkUgMTYgUFhcblxuICAgICAgICBpZih0aGlzLnN0eWxlLmhhc093blByb3BlcnR5KFwidmFsdWVTdHlsZVwiKSl7XG4gICAgICAgICAgICBpZih0aGlzLnN0eWxlLnZhbHVlU3R5bGUuZm9udCAhPSBcIlwiKXtcbiAgICAgICAgICAgICAgICB2YXIgZm9udFNpemUgPSAvXFxkK3B4Ly5leGVjKHRoaXMuc3R5bGUudmFsdWVTdHlsZS5mb250KVswXS5zcGxpdCgvW0Etel0rLyk7XG4gICAgICAgICAgICAgICAgaWYoZm9udFNpemUgIT0gbnVsbCApe1xuICAgICAgICAgICAgICAgICAgICBTaXplID0gcGFyc2VJbnQoZm9udFNpemUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICByZXR1cm4ge1xuICAgICAgICAgICAgeDpNYXRoLnJvdW5kKHRleHRXZHRoLzIpLFxuICAgICAgICAgICAgeTpNYXRoLnJvdW5kKFNpemUpLzJcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmdW5jdGlvbiB0byBzZXQgc3R5bGUgb2YgY2lyY2xlXG4gICAgICogKi9cbiAgICB0aGlzLnNldENpcmNsZVN0eWxlID0gZnVuY3Rpb24oKXtcbiAgICAgICAgLy8gQUREIExJTkUgV0lEVEggVE8gQ0lSQ0xFXG4gICAgICAgIGlmKHRoaXMuc3R5bGUubGluZUZvcmNlID4gMSl7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQubGluZVdpZHRoID0gdGhpcy5zdHlsZS5saW5lRm9yY2UgO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQubGluZVdpZHRoID0gMSA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gQUREIENPTE9SIFRPIENJUkNMRVxuICAgICAgICBpZih0eXBlb2YgdGhpcy5zdHlsZS5jb2xvciA9PSBcInN0cmluZ1wiICYmIHRoaXMuc3R5bGUuY29sb3IgIT1cIlwiICl7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuc3Ryb2tlU3R5bGUgPSB0aGlzLnN0eWxlLmNvbG9yO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNvbnRlbnQuc3Ryb2tlU3R5bGUgPSBcImJsYWNrXCI7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gdG8gc2V0IHN0eWxlIG9mIHRleHRcbiAgICAgKiAqL1xuICAgIHRoaXMuc2V0VGV4dFN0eWxlID0gZnVuY3Rpb24gKCl7XG4gICAgICAgIC8vIFdSSVRJTkcgVkFMVUUgSUYgREVWRUxPUEVSIFNFVCBJVFxuICAgICAgICB0aGlzLmNvbnRlbnQuZmlsbFN0eWxlID0gXCJibGFja1wiO1xuICAgICAgICB0aGlzLmNvbnRlbnQuZm9udCA9IFwiMTBweCBhcmlhbFwiO1xuXG4gICAgICAgIGlmKHRoaXMuc3R5bGUuaGFzT3duUHJvcGVydHkoXCJ2YWx1ZVN0eWxlXCIpKXtcbiAgICAgICAgICAgIGlmKHRoaXMuc3R5bGUudmFsdWVTdHlsZS5mb250ICE9XCJcIiApe1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5mb250ID0gdGhpcy5zdHlsZS52YWx1ZVN0eWxlLmZvbnQgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodGhpcy5zdHlsZS52YWx1ZVN0eWxlLmNvbG9yICE9IFwiXCIgKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQuZmlsbFN0eWxlID0gdGhpcy5zdHlsZS52YWx1ZVN0eWxlLmNvbG9yIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gdG8gcmVzZXQgdGhlIGNhbnZhcyBkcmF3aW5nIHBhcmFtc1xuICAgICAqICovXG4gICAgdGhpcy5yZXNldENhbnZhc1BhcmFtID0gZnVuY3Rpb24oKXtcbiAgICAgICAgdGhpcy5jb250ZW50LmZvbnQgPSBcIjEwcHggYXJpYWxcIjtcbiAgICAgICAgdGhpcy5jb250ZW50LmZpbGxTdHlsZSA9IFwiYmxhY2tcIjtcbiAgICAgICAgdGhpcy5jb250ZW50LnN0cm9rZVN0eWxlID0gXCJibGFja1wiO1xuICAgICAgICB0aGlzLmNvbnRlbnQubGluZVdpZHRoID0gMSA7XG4gICAgfTtcbiAgICAvKipcbiAgICAgKiBmdW5jdGlvbiB0byB3cml0ZSB0aGUgdmFsdWUgYXQgY29ybmVyIG9mIGNhbnZhc1xuICAgICAqIEBwYXJhbSB7c3RyaW5nfSB2YWx1ZVxuICAgICAqKi9cbiAgICB0aGlzLndyaXRlQ29ucm5lclZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKXtcbiAgICAgICAgdGhpcy5yZXNldENhbnZhc1BhcmFtKCk7XG4gICAgICAgIHZhciBjb3JkID0ge3g6MCx5OjEwfTtcbiAgICAgICAgaWYodGhpcy5zdHlsZS5hdENvcm5lciA9PSByaWdodFRvcCl7XG4gICAgICAgICBjb3JkLnggPSB0aGlzLmRpbXMudyAtIHRoaXMuY29udGVudC5tZWFzdXJlVGV4dCh2YWx1ZSkud2lkdGg7XG4gICAgICAgIH1cbiAgICAgICAgaWYodGhpcy5zdHlsZS5oYXNPd25Qcm9wZXJ0eShcImNvcm5lclZhbHVlU3R5bGVcIikpe1xuICAgICAgICAgICAgLy8gc2V0IGZvbnQgc3R5bGVcbiAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLnN0eWxlLmNvcm5lclZhbHVlU3R5bGUuZm9udCA9PSBcInN0cmluZ1wiICYmIHRoaXMuc3R5bGUuY29ybmVyVmFsdWVTdHlsZS5mb250ICE9IFwiXCIpe1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5mb250ID0gdGhpcy5zdHlsZS5jb3JuZXJWYWx1ZVN0eWxlLmZvbnQgO1xuICAgICAgICAgICAgICAgIGlmKCFpc05hTihwYXJzZUludCgvXFxkK3B4Ly5leGVjKHRoaXMuc3R5bGUuY29ybmVyVmFsdWVTdHlsZS5mb250KVswXS5zcGxpdCgvW0Etel0rLylbMF0pKSkge1xuICAgICAgICAgICAgICAgICAgICBjb3JkLnkgPSBwYXJzZUludCgvXFxkK3B4Ly5leGVjKHRoaXMuc3R5bGUuY29ybmVyVmFsdWVTdHlsZS5mb250KVswXS5zcGxpdCgvW0Etel0rLylbMF0pIDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBzZXQgY29sb3JcbiAgICAgICAgICAgIGlmKHR5cGVvZiB0aGlzLnN0eWxlLmNvcm5lclZhbHVlU3R5bGUuY29sb3IgPT0gXCJzdHJpbmdcIiAmJiB0aGlzLnN0eWxlLmNvcm5lclZhbHVlU3R5bGUuY29sb3Ipe1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5maWxsU3R5bGUgPSB0aGlzLnN0eWxlLmNvcm5lclZhbHVlU3R5bGUuY29sb3IgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGVudC5maWxsVGV4dCh2YWx1ZSAsIGNvcmQueCxjb3JkLnkpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gdG8gZHJhdyB0aGUgYm9yZGVyIG9mIGNpcmNsZVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBtaWRkbGVDb3JkXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0QW5nbGVcbiAgICAgKiAqL1xuICAgIHRoaXMuZHJhd0JvcmRlciA9IGZ1bmN0aW9uKG1pZGRsZUNvcmQsc3RhcnRBbmdsZSl7XG4gICAgICAgIHRoaXMuY29udGVudC5iZWdpblBhdGgoKTtcbiAgICAgICAgdmFyIGVuZEFuZ2xlID0gMipNYXRoLlBJO1xuICAgICAgICB2YXIgbGluZUZvcmNlID0gMTtcbiAgICAgICAgaWYodGhpcy5zdHlsZS5saW5lRm9yY2UgPiAxKXtcbiAgICAgICAgICAgIGxpbmVGb3JjZSArPXRoaXMuc3R5bGUubGluZUZvcmNlO1xuICAgICAgICB9XG4gICAgICAgIGlmKHR5cGVvZiB0aGlzLnN0eWxlLm1heEFuZ2xlID09PSBcIm51bWJlclwiICYmIHRoaXMuc3R5bGUubWF4QW5nbGUgPiAwKXtcbiAgICAgICAgICAgIGVuZEFuZ2xlID0gZGVnVG9SYWQodGhpcy5zdHlsZS5tYXhBbmdsZSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYodHlwZW9mIHRoaXMuc3R5bGUud2l0aEJvcmRlci5saW5lRm9yY2UgPT09IFwibnVtYmVyXCIgJiYgdGhpcy5zdHlsZS53aXRoQm9yZGVyLmxpbmVGb3JjZSA+IDEpe1xuICAgICAgICAgICAgbGluZUZvcmNlICs9IHRoaXMuc3R5bGUud2l0aEJvcmRlci5saW5lRm9yY2UgO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGVudC5saW5lV2lkdGggPSBsaW5lRm9yY2UgO1xuICAgICAgICBpZih0eXBlb2YgdGhpcy5zdHlsZS53aXRoQm9yZGVyLmNvbG9yID09PSBcInN0cmluZ1wiICYmIHRoaXMuc3R5bGUud2l0aEJvcmRlci5jb2xvciAhPSBcIlwiKXtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5zdHJva2VTdHlsZSA9IHRoaXMuc3R5bGUud2l0aEJvcmRlci5jb2xvciA7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5zdHJva2VTdHlsZSA9IFwiZ3JheVwiIDtcblxuICAgICAgICB9XG4gICAgICAgIHRoaXMuY29udGVudC5hcmMobWlkZGxlQ29yZC54LG1pZGRsZUNvcmQueSx0aGlzLmdldFJheW9uKCksc3RhcnRBbmdsZSxzdGFydEFuZ2xlK2VuZEFuZ2xlKTtcbiAgICAgICAgdGhpcy5jb250ZW50LnN0cm9rZSgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gdG8gZHJhdyB0aGUgYWxsIGNvbnRlbnQgb2YgY2FudmFzXG4gICAgICogKi9cbiAgICB0aGlzLmRyYXcgPSBmdW5jdGlvbih2YWx1ZSl7XG5cbiAgICAgICAgaWYodGhpcy5kcmF3aW5nID09IGZhbHNlICl7XG4gICAgICAgICAgICB0aGlzLmRyYXdpbmcgPSB0cnVlIDtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuY29udGVudC5iZWdpblBhdGgoKTtcbiAgICAgICAgdGhpcy5jbGVhckNhbnZhcygpO1xuICAgICAgICB0aGlzLnJlc2V0Q2FudmFzUGFyYW0oKTtcbiAgICAgICAgdmFyIHN0YXJ0QW5nbGUgPSAwLFxuICAgICAgICAgICAgZW5kQW5nbGUgPSB0aGlzLnBvcmNUb1JhZCh2YWx1ZSk7XG4gICAgICAgIHZhciBtaWRkbGVDb3JkID0ge3g6dGhpcy5kaW1zLncvMix5OnRoaXMuZGltcy5oLzJ9O1xuXG4gICAgICAgIC8vIEFERCBTVEFSVCBBTkdMRVxuICAgICAgICBpZih0aGlzLnN0eWxlLmhhc093blByb3BlcnR5KFwic3RhcnRBbmdsZVwiKSl7XG4gICAgICAgICAgICBzdGFydEFuZ2xlID0gZGVnVG9SYWQodGhpcy5zdHlsZS5zdGFydEFuZ2xlKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmKHRoaXMuc3R5bGUubWF4QW5nbGUgPD0gMTgwKXtcbiAgICAgICAgICAgIG1pZGRsZUNvcmQueSA9IHRoaXMuZGltcy5oIDtcbiAgICAgICAgICAgIHRoaXMuaGFsZkNpcmNsZSA9IHRydWUgO1xuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmhhbGZDaXJjbGUgPSBmYWxzZSA7XG4gICAgICAgIH1cbiAgICAgICAgLy8gRFJBVyBCT1JERVIgT0YgVEhFIENJUkNMRVxuICAgICAgICBpZih0eXBlb2YgdGhpcy5zdHlsZS53aXRoQm9yZGVyID09PSBcIm9iamVjdFwiICYmIHRoaXMuc3R5bGUuaGFzT3duUHJvcGVydHkoXCJ3aXRoQm9yZGVyXCIpKXtcbiAgICAgICAgICAgIHRoaXMuZHJhd0JvcmRlcihtaWRkbGVDb3JkLHN0YXJ0QW5nbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5yZXNldENhbnZhc1BhcmFtKCk7XG4gICAgICAgIC8vIEFERCBTVFlMRSBDT05GSUcgT0YgQ0lSQ0xFXG4gICAgICAgIHRoaXMuc2V0Q2lyY2xlU3R5bGUoKTtcbiAgICAgICAgLy8gRFJBVyBDSVJDTEVcbiAgICAgICAgdGhpcy5jb250ZW50LmJlZ2luUGF0aCgpO1xuICAgICAgICB0aGlzLmNvbnRlbnQuYXJjKG1pZGRsZUNvcmQueCAsIG1pZGRsZUNvcmQueSAsXG4gICAgICAgICAgICB0aGlzLmdldFJheW9uKCksc3RhcnRBbmdsZSxzdGFydEFuZ2xlICsgZW5kQW5nbGUpO1xuXG4gICAgICAgIHRoaXMuY29udGVudC5zdHJva2UoKSA7XG4gICAgICAgIGlmKHRoaXMuc3R5bGUuZmlsbENpcmNsUmVzdCA9PSB0cnVlKXtcbiAgICAgICAgICAgIHRoaXMuZmlsbENpcmNsZVJlc3Qoc3RhcnRBbmdsZSArIGVuZEFuZ2xlLG1pZGRsZUNvcmQpIDtcbiAgICAgICAgfVxuICAgICAgICAvLyBEUkFXIEVORCBMSU5FXG4gICAgICAgIGlmKHRoaXMuc3R5bGUud2l0aEVuZExpbmUgPT0gdHJ1ZSl7XG4gICAgICAgICAgICB0aGlzLmRyYXdFbmRMaW5lKHN0YXJ0QW5nbGUgKyBlbmRBbmdsZSk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyB3cml0ZSB0aGUgdmFsdWUgaW4gbWlkZGxlXG4gICAgICAgIGlmKHRoaXMuc3R5bGUud2l0aFZhbHVlID09IHRydWUpIHtcbiAgICAgICAgICAgIHRoaXMud3JpdGVUZXh0KHZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnN0eWxlLmNvcm5lclZhbHVlID09IHRydWUgJiYgL3JpZ2h0VG9wfGxlZnRUb3AvLnRlc3QodGhpcy5zdHlsZS5hdENvcm5lcikpe1xuICAgICAgICAgICAgdGhpcy53cml0ZUNvbnJuZXJWYWx1ZSh0aGlzLmdldFZhbHVlQnlUeXBlKFN0cmluZyh2YWx1ZSkpKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB3aGVuIHlvdSBzZXQgd2l0aEFuaW1hdGlvbiBhdHRyaWJ1dGVcbiAgICAgICAgaWYodGhpcy5zdHlsZS53aXRoQW5pbWF0aW9uID09IHRydWUpe1xuICAgICAgICAgICAgdGhpcy5hbmltYXRlKCk7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gZm9yIGFuaW1hdGlvbnNcbiAgICAgKiAqL1xuICAgIHRoaXMuYW5pbWF0ZSA9IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgaWYoIXRoaXMuc3R5bGUuaGFzT3duUHJvcGVydHkoXCJhbmltYXRpb25EdXJhdGlvblwiKSl7XG4gICAgICAgICAgICB0aGlzLnN0eWxlLmFuaW1hdGlvbkR1cmF0aW9uID0gMTAwMCA7XG4gICAgICAgIH1cblxuICAgICAgICBpZih0aGlzLmN1cnJlbnRUaW1lIDw9IHRoaXMuc3R5bGUuYW5pbWF0aW9uRHVyYXRpb24gJiYgdGhpcy5vbGRQZXJjICE9IHRoaXMucGVyYyl7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSAwIDtcbiAgICAgICAgICAgIGlmKHRoaXMub2xkUGVyYyA8IHRoaXMucGVyYyl7XG4gICAgICAgICAgICAgICAgdmFsdWUgPSB0aGlzLmxpbmVhckFuaW1hdGlvbih0aGlzLm9sZFBlcmMsdGhpcy5wZXJjLHRoaXMuc3R5bGUuYW5pbWF0aW9uRHVyYXRpb24gLCB0aGlzLmN1cnJlbnRUaW1lKSA7XG4gICAgICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgICAgICB2YWx1ZSA9IHRoaXMubGluZWFyQW5pbWF0aW9uKHRoaXMub2xkUGVyYyx0aGlzLnBlcmMsdGhpcy5zdHlsZS5hbmltYXRpb25EdXJhdGlvbiAsIHRoaXMuY3VycmVudFRpbWUpIDtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSh0aGlzLmRyYXcuYmluZCh0aGlzLHZhbHVlKSk7XG4gICAgICAgICAgICB0aGlzLmN1cnJlbnRUaW1lICs9IHRoaXMuZ2V0QW5pbWF0aW9uU3RlcCgpIDtcbiAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgdGhpcy5vbGRQZXJjID0gdGhpcy5wZXJjIDtcbiAgICAgICAgICAgIHRoaXMuY3VycmVudFRpbWUgPSAwO1xuICAgICAgICB9XG4gICAgfTtcbiAgICB0aGlzLmdldEFuaW1hdGlvblN0ZXAgID0gZnVuY3Rpb24oKXtcbiAgICAgICAgZm9yKHZhciBpID0gMTAgOyBpID4gMCA7IGktLSl7XG4gICAgICAgICAgICBpZih0aGlzLnN0eWxlLmFuaW1hdGlvbkR1cmF0aW9uICVpID09IDApe1xuICAgICAgICAgICAgICAgIHJldHVybiBpIDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmdW5jdGlvbiB0byBnZXQgdmFsdWUgdG8gZHJhdyBpbiByZWxhdGlvbiB3aXRoIHRpbWVcbiAgICAgKiBAcGFyYW0ge251bWJlcn0gZnJvbSBhbmltYXRpb24gc3RhcnQgZnJvbVxuICAgICAqIEBwYXJhbSB7bnVtYmVyfSB0byB0aGUgdmFsdWUgdG8gZHJhd1xuICAgICAqIEBwYXJhbSB7bnVtYmVyfSBkdXJhdGlvbiBkdXJhdGlvbiBvZiBhbmltYXRpb25cbiAgICAgKiBAcGFyYW0ge251bWJlcn0gdGltZSBjdXJyZW50IHRpbWVcbiAgICAgKiBAcmV0dXJuIHtudW1iZXJ9IHZhbHVlIHRvIGRyYXdcbiAgICAgKiAqL1xuICAgIHRoaXMubGluZWFyQW5pbWF0aW9uID0gZnVuY3Rpb24gKGZyb20gLCB0byAsIGR1cmF0aW9uICwgdGltZSl7XG4gICAgICAgIHJldHVybiBNYXRoLnJvdW5kKHRpbWUqKHRvL2R1cmF0aW9uLWZyb20vZHVyYXRpb24pK3RoaXMub2xkUGVyYyk7XG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGZ1bmN0aW9uIHRvIGNsZWFyIHRoZSBjYW52YXNcbiAgICAgKiAqL1xuICAgIHRoaXMuY2xlYXJDYW52YXMgPSBmdW5jdGlvbiAoKXtcbiAgICAgICAgdGhpcy5jb250ZW50LmNsZWFyUmVjdCgwLDAsdGhpcy5kaW1zLncsdGhpcy5kaW1zLmgpO1xuICAgIH07XG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gcmV0dXJuIHRoZSB2YWx1ZSB0byB3cml0ZSBieSB0eXBlIG9mIHRoZSBjaXJjbGVcbiAgICAgKiBAcGFyYW0ge3N0cmluZ30gdmFsdWVcbiAgICAgKiBAcmV0dXJuIHtzdHJpbmd9IHZhbHVlXG4gICAgICogKi9cbiAgICB0aGlzLmdldFZhbHVlQnlUeXBlID0gZnVuY3Rpb24odmFsdWUpe1xuICAgICAgICBpZih0aGlzLnN0eWxlLnZhbHVlVHlwZSA9PSBQRVJDKXtcbiAgICAgICAgICAgIHZhbHVlICs9IFwiJVwiO1xuICAgICAgICB9ZWxzZSBpZih0aGlzLnN0eWxlLnZhbHVlVHlwZSA9PSBUSU1FKXtcbiAgICAgICAgICAgIHZhbHVlID0gVGltZVN0YW1wVG9TdHJpbmcocGFyc2VJbnQodmFsdWUpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gdmFsdWVcbiAgICB9O1xuICAgIC8qKlxuICAgICAqIGZ1bmN0aW9uIHRvIHdyaXRlIHRoZSB2YWx1ZSBpbiB0aGUgbWlkZGxlIG9mIGNhbnZhc1xuICAgICAqICovXG4gICAgdGhpcy53cml0ZVRleHQgPSBmdW5jdGlvbiAodmFsdWUpe1xuICAgICAgICB0aGlzLnNldFRleHRTdHlsZSgpIDtcblxuICAgICAgICB2YXIgdGV4dD0gdGhpcy5nZXRWYWx1ZUJ5VHlwZShTdHJpbmcodmFsdWUpKTtcblxuICAgICAgICBpZih0aGlzLnN0eWxlLmhhc093blByb3BlcnR5KFwidmFsdWVTdHlsZVwiKSl7XG4gICAgICAgICAgICBpZigvZm9udEF3ZXNvbWUvaS50ZXN0KHRoaXMuc3R5bGUudmFsdWVTdHlsZS5mb250KSl7XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMuc3R5bGUuaWNvbiA9PSBcInN0cmluZ1wiICYmIHRoaXMuc3R5bGUuaWNvbiAhPSBcIlwiKXtcbiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHRoaXMuc3R5bGUuaWNvbiA7XG4gICAgICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdmFyIHRleHRNaWRkbGUgPSB0aGlzLmdldFRleHRNaWRkbGUoU3RyaW5nKHRleHQpKTtcbiAgICAgICAgaWYodGhpcy5oYWxmQ2lyY2xlKXtcbiAgICAgICAgICAgIC8vIHRvIHdyaXRlIHRleHQgaW4gYm90dG9tIG9mIHRoZSBjYW52YXNcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5maWxsVGV4dCh0ZXh0LHRoaXMuZGltcy53LzIgLSB0ZXh0TWlkZGxlLnhcbiAgICAgICAgICAgICAgICAsIHRoaXMuZGltcy5oIC0gdGV4dE1pZGRsZS55LzIpO1xuICAgICAgICB9ZWxzZXtcbiAgICAgICAgICAgIC8vIHRvIHdyaXRlIHRleHQgaW4gbWlkZGxlIG9mIHRoZSBjYW52YXNcbiAgICAgICAgICAgIHRoaXMuY29udGVudC5maWxsVGV4dCh0ZXh0LHRoaXMuZGltcy53LzIgLSB0ZXh0TWlkZGxlLnhcbiAgICAgICAgICAgICAgICAsIHRoaXMuZGltcy5oLzIgKyB0ZXh0TWlkZGxlLnkvMik7XG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLyoqXG4gICAgICogZnVuY3Rpb24gdG8gZHJhdyB0aGUgbGluZSBpbiB0aGUgZW5kIG9mIGZpbGxlZCBjaXJjbGVcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gYW5nbGUgcmFkaWFuIGFuZ2xlXG4gICAgICogKi9cbiAgICB0aGlzLmRyYXdFbmRMaW5lID0gZnVuY3Rpb24oYW5nbGUpe1xuICAgICAgICB0aGlzLnJlc2V0Q2FudmFzUGFyYW0oKSA7XG4gICAgICAgIHZhciBjb3JkTWlkZGxlID0ge3g6dGhpcy5kaW1zLncvMix5OnRoaXMuZGltcy53LzJ9LG9mZnNldCA9IDA7XG4gICAgICAgIHRoaXMuY29udGVudC5zdHJva2VTdHlsZSA9IFwid2hpdGVcIjtcblxuICAgICAgICAvL3N0YXJ0IHN0eWxpbmcgbGluZSBlbmRcbiAgICAgICAgaWYodGhpcy5zdHlsZS5oYXNPd25Qcm9wZXJ0eShcImxpbmVFbmRTdHlsZVwiKSl7XG4gICAgICAgICAgICBpZih0aGlzLnN0eWxlLmxpbmVFbmRTdHlsZS5saW5lRm9yY2UgPjEpe1xuICAgICAgICAgICAgICAgIHRoaXMuY29udGVudC5saW5lV2lkdGggPSB0aGlzLnN0eWxlLmxpbmVFbmRTdHlsZS5saW5lRm9yY2UgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMuc3R5bGUubGluZUVuZFN0eWxlLmNvbG9yID09IFwic3RyaW5nXCIgJiYgdGhpcy5zdHlsZS5saW5lRW5kU3R5bGUuY29sb3IgIT0gXCJcIil7XG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZW50LnN0cm9rZVN0eWxlID0gdGhpcy5zdHlsZS5saW5lRW5kU3R5bGUuY29sb3IgO1xuICAgICAgICAgICAgfVxuICAgICAgICB9Ly9lbmQgc3R5bGluZyBvZiBsaW5lIGVuZFxuXG4gICAgICAgIGlmKHR5cGVvZiB0aGlzLnN0eWxlLmxpbmVGb3JjZSA9PSBcIm51bWJlclwiICYmIHRoaXMuc3R5bGUubGluZUZvcmNlID4gMSl7XG4gICAgICAgICAgICBvZmZzZXQgKz0gdGhpcy5zdHlsZS5saW5lRm9yY2UvMiA7XG4gICAgICAgIH1cblxuICAgICAgICB2YXIgZW5kUG9pbnQgPSBnZXRDb3JkRnJvbUFuZ2xlKGNvcmRNaWRkbGUsdGhpcy5nZXRSYXlvbigpK29mZnNldCxhbmdsZSksXG4gICAgICAgICAgICBzdGFydFBvaW50ID0gZ2V0Q29yZEZyb21BbmdsZShjb3JkTWlkZGxlLHRoaXMuZ2V0UmF5b24oKS1vZmZzZXQsYW5nbGUpO1xuXG4gICAgICAgIHRoaXMuY29udGVudC5iZWdpblBhdGgoKTtcbiAgICAgICAgdGhpcy5jb250ZW50Lm1vdmVUbyhlbmRQb2ludC54ICwgZW5kUG9pbnQueSApO1xuICAgICAgICB0aGlzLmNvbnRlbnQubGluZVRvKHN0YXJ0UG9pbnQueCwgc3RhcnRQb2ludC55KTtcbiAgICAgICAgdGhpcy5jb250ZW50LnN0cm9rZSgpO1xuXG4gICAgfTtcblxuICAgIC8qKlxuICAgICAqIGZ1bmN0aW9uIHRvIGZpbGwgdGhlIHJlc3Qgb2YgY2lyY2xlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHN0YXJ0QW5nbGUgcmFkaWFuIGFuZ2xlXG4gICAgICogQHBhcmFtIG1pZGRsZUNvcmRcbiAgICAgKiAqL1xuICAgIHRoaXMuZmlsbENpcmNsZVJlc3QgPSBmdW5jdGlvbiAoc3RhcnRBbmdsZSxtaWRkbGVDb3JkKXtcblxuICAgICAgICB0aGlzLmNvbnRlbnQuYmVnaW5QYXRoKCk7XG4gICAgICAgIHRoaXMucmVzZXRDYW52YXNQYXJhbSgpO1xuICAgICAgICB0aGlzLmNvbnRlbnQuc3Ryb2tlU3R5bGUgPSBcImdyYXlcIjtcbiAgICAgICAgaWYodGhpcy5zdHlsZS5oYXNPd25Qcm9wZXJ0eShcImZpbGxSZXN0U3R5bGVcIikpe1xuICAgICAgICAgICAgaWYodHlwZW9mIHRoaXMuc3R5bGUuZmlsbFJlc3RTdHlsZS5jb2xvciA9PSBcInN0cmluZ1wiICYmIHRoaXMuc3R5bGUuZmlsbFJlc3RTdHlsZS5jb2xvciAhPSBcIlwiKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQuc3Ryb2tlU3R5bGUgPSB0aGlzLnN0eWxlLmZpbGxSZXN0U3R5bGUuY29sb3I7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZih0aGlzLnN0eWxlLmZpbGxSZXN0U3R5bGUubGluZUZvcmNlID4wKXtcbiAgICAgICAgICAgICAgICB0aGlzLmNvbnRlbnQubGluZVdpZHRoID0gdGhpcy5zdHlsZS5maWxsUmVzdFN0eWxlLmxpbmVGb3JjZSA7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgdmFyIGVuZEFuZ2xlID0gMipNYXRoLlBJIDtcbiAgICAgICAgLy8gQUREIFNUQVJUIEFOR0xFXG4gICAgICAgIGlmKHRoaXMuc3R5bGUuaGFzT3duUHJvcGVydHkoXCJtYXhBbmdsZVwiKSl7XG4gICAgICAgICAgICBlbmRBbmdsZSA9IGRlZ1RvUmFkKHRoaXMuc3R5bGUubWF4QW5nbGUpIDtcbiAgICAgICAgfVxuICAgICAgICBpZih0aGlzLnN0eWxlLnN0YXJ0QW5nbGU+MCl7XG4gICAgICAgICAgICBlbmRBbmdsZSArPSBkZWdUb1JhZCh0aGlzLnN0eWxlLnN0YXJ0QW5nbGUpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5jb250ZW50LmFyYyhtaWRkbGVDb3JkLngsIG1pZGRsZUNvcmQueSAsXG4gICAgICAgICAgICB0aGlzLmdldFJheW9uKCksc3RhcnRBbmdsZSxlbmRBbmdsZSk7XG5cbiAgICAgICAgdGhpcy5jb250ZW50LnN0cm9rZSgpO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmdW5jdGlvbiB0byBjaGFuZ2UgdmFsdWUgb2YgY2lyY2xlXG4gICAgICogQHBhcmFtIHtudW1iZXJ9IHZhbHVlXG4gICAgICogKi9cbiAgICB0aGlzLnNldFZhbHVlID0gZnVuY3Rpb24gKHZhbHVlKXtcbiAgICAgICAgdGhpcy5wZXJjID0gdmFsdWUgO1xuICAgIH07XG5cbiAgICAvKipcbiAgICAgKiBmdW5jdGlvbiB0byBjaGFuZ2UgdGhlIGNpcmNsZSBzdHlsZVxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBzdHlsZVxuICAgICAqICovXG4gICAgdGhpcy51cGRhdGVDaXJjbGVTdHlsZSA9IGZ1bmN0aW9uIChzdHlsZSl7XG4gICAgICAgIHRoaXMuc3R5bGUgPSBzdHlsZSA7XG4gICAgfTtcblxuICAgIHRoaXMuc3RhcnREcmF3aW5nID0gZnVuY3Rpb24gKCl7XG4gICAgICAgIHRoaXMuY3VycmVudFRpbWUgPSAwIDtcblxuICAgICAgICAvLyBXSEVOIERFViBDUkVBVEUgSU5TVEFOQ0UgT0YgVEhJUyBPQkpFQ1RcbiAgICAgICAgaWYodGhpcy5zdHlsZS53aXRoQW5pbWF0aW9uICE9IHRydWUpe1xuICAgICAgICAgICAgdGhpcy5vbGRQZXJjID0gdGhpcy5wZXJjIDtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmRyYXcodGhpcy5vbGRQZXJjKTtcbiAgICAgICAgcmV0dXJuIHRoaXMgO1xuICAgIH1cbn0iXSwic291cmNlUm9vdCI6IiJ9